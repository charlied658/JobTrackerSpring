<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${customer.name}">Customer Details</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>

<nav style="margin-bottom: 20px;">
    <a href="/view/customers">Customers</a> |
    <a href="/view/jobs">Jobs</a> |
    <a href="/view/services">Services</a>

    <br><span th:text="${customer.name}"></span>
</nav>

<div class="container">
    <h1 th:text="${customer.name}">Customer Name</h1>
    <p><strong>Business:</strong> <span th:text="${customer.business}"></span></p>
    <p><strong>Phone:</strong> <span th:text="${customer.phone}"></span></p>
    <p><strong>Email:</strong> <span th:text="${customer.email}"></span></p>
    <p><strong>Address:</strong> <span th:text="${customer.address}"></span></p>

    <!-- Edit Customer Button -->
    <button onclick="openEditCustomerModal()" class="edit-button">Edit Customer</button>

    <h2>Jobs</h2>

    <a class ="box-link" onclick = "openAddJobModal()">
        <div class = "add-clickable-box">
            <div class="circle-plus">+</div>
            <span>Add Job</span>
        </div>
    </a>

    <div class="job-list">
        <section class="job-box" th:each="job : ${jobs}">
            <a th:href="@{/view/jobs/{id}(id=${job.id})}" class="box-link">
                <div class = "clickable-box">
                    <h3 th:text="${job.lossType}">Loss Type</h3>
                    <p><strong>Status:</strong> <span th:text="${job.status}"></span></p>
                    <p><strong>Description:</strong> <span th:text="${job.description}"></span></p>
                    <p><strong>Last Service Date:</strong> <span th:text="${job.latestServiceDate}"></span></p>

                </div>
            </a>
        </section>
    </div>
</div>
</body>

<!-- Add Job Modal -->
<div id="addJobModalOverlay" class="modal-overlay" style="display:none;">
    <div class="modal">
        <button class="close-button" onclick="closeAddJobModal()">âœ–</button>
        <h2>Add Job</h2>
        <form method="post" th:action="@{/jobs/add}" id="addJobForm">
            <input type="hidden" name="customerId" th:value="${customer.id}" />

            <label for="lossType">Loss Type:</label><br>
            <input type="text" id="lossType" name="lossType" required><br><br>

            <label for="description">Description:</label><br>
            <input type="text" id="description" name="description"><br><br>

            <button type="submit" class="save-button">ðŸ’¾ Save</button>
        </form>
    </div>
</div>

<!-- Edit Customer Modal -->
<div id="editCustomerModalOverlay" class="modal-overlay" style="display: none;">
    <div class="modal">
        <button class="close-button" onclick="closeEditCustomerModal()">âœ–</button>
        <h2>Edit Customer</h2>
        <form method="post" th:action="@{/customers/edit}">
            <input type="hidden" name="id" th:value="${customer.id}" />

            <label for="editName">Name:</label><br>
            <input type="text" id="editName" name="name" th:value="${customer.name}" required><br><br>

            <label for="editBusiness">Business:</label><br>
            <input type="text" id="editBusiness" name="business" th:value="${customer.business}"><br><br>

            <label for="editPhone">Phone:</label><br>
            <input type="text" id="editPhone" name="phone" th:value="${customer.phone}"><br><br>

            <label for="editEmail">Email:</label><br>
            <input type="text" id="editEmail" name="email" th:value="${customer.email}"><br><br>

            <label for="editAddress">Address:</label><br>
            <input type="text" id="editAddress" name="address" th:value="${customer.address}"><br><br>

            <button type="submit" class="save-button">ðŸ’¾ Save</button>
        </form>
    </div>
</div>

<script>
    function openAddJobModal() {
        document.getElementById('addJobModalOverlay').style.display = 'flex';
    }

    function closeAddJobModal() {
        document.getElementById('addJobModalOverlay').style.display = 'none';
    }

    function openEditCustomerModal() {
        document.getElementById('editCustomerModalOverlay').style.display = 'flex';
    }

    function closeEditCustomerModal() {
        document.getElementById('editCustomerModalOverlay').style.display = 'none';
    }
</script>


</html>